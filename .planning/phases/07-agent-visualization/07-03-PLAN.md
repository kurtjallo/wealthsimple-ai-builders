---
phase: 07-agent-visualization
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - package.json
  - src/components/pipeline/agent-status-card.tsx
  - src/components/pipeline/agent-pipeline-view.tsx
  - src/components/pipeline/pipeline-stage-indicator.tsx
  - src/components/pipeline/confidence-ring.tsx
  - src/components/pipeline/processing-timer.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Framer Motion is installed and used for all pipeline component animations"
    - "Agent cards animate in when they transition from pending to running (scale + fade)"
    - "Agent cards animate their status changes smoothly (running to completed transition)"
    - "The pipeline stage indicator animates progress with spring physics"
    - "Completed agents display an animated confidence ring that fills to the confidence percentage"
    - "Running agents display a live elapsed time counter that ticks every 100ms"
    - "All animations are smooth (60fps) and enhance rather than distract"
  artifacts:
    - path: "src/components/pipeline/confidence-ring.tsx"
      provides: "Animated circular confidence indicator that fills from 0 to target percentage"
      exports: ["ConfidenceRing"]
    - path: "src/components/pipeline/processing-timer.tsx"
      provides: "Live elapsed timer that counts up while an agent is running"
      exports: ["ProcessingTimer"]
  key_links:
    - from: "src/components/pipeline/agent-status-card.tsx"
      to: "framer-motion"
      via: "motion.div wrapping the card for enter/exit animations"
      pattern: "import.*motion.*from.*framer-motion"
    - from: "src/components/pipeline/confidence-ring.tsx"
      to: "framer-motion"
      via: "motion.circle for animated SVG confidence ring"
      pattern: "import.*motion.*from.*framer-motion"
    - from: "src/components/pipeline/agent-pipeline-view.tsx"
      to: "framer-motion"
      via: "AnimatePresence and LayoutGroup for coordinated animations"
      pattern: "import.*AnimatePresence.*from.*framer-motion"
---

<objective>
Add Framer Motion animations to all pipeline visualization components — entrance animations, status transitions, confidence indicators, and a live processing timer. Transform the static pipeline view into a dynamic, cinematic experience.

Purpose: Animations are THE differentiator between "developer project" and "real product." The demo video needs to show agents activating, processing, and completing with smooth visual feedback. This is what makes the compliance officer (and the WS reviewer) go "wow." Framer Motion provides spring physics, layout animations, and AnimatePresence for mount/unmount transitions — all essential for a polished pipeline visualization.

Output: Framer Motion installed, all pipeline components enhanced with animations, plus two new micro-components (ConfidenceRing, ProcessingTimer) that add rich visual detail.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-agent-visualization/07-02-SUMMARY.md
@src/components/pipeline/agent-status-card.tsx
@src/components/pipeline/agent-pipeline-view.tsx
@src/components/pipeline/pipeline-stage-indicator.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Framer Motion and create micro-animation components</name>
  <files>package.json, src/components/pipeline/confidence-ring.tsx, src/components/pipeline/processing-timer.tsx</files>
  <action>
    1. Install Framer Motion:
       ```bash
       npm install framer-motion
       ```

    2. Create `src/components/pipeline/confidence-ring.tsx` — animated SVG circular progress indicator:

       ```typescript
       'use client';

       import { motion } from 'framer-motion';
       import { cn } from '@/lib/utils';

       interface ConfidenceRingProps {
         confidence: number; // 0-1
         size?: number;      // px, default 48
         strokeWidth?: number; // px, default 3
         className?: string;
       }

       export function ConfidenceRing({
         confidence,
         size = 48,
         strokeWidth = 3,
         className,
       }: ConfidenceRingProps) {
         const radius = (size - strokeWidth) / 2;
         const circumference = 2 * Math.PI * radius;
         const offset = circumference - confidence * circumference;

         // Color based on confidence level
         const color =
           confidence >= 0.9 ? '#10b981' : // emerald-500
           confidence >= 0.7 ? '#3b82f6' : // blue-500
           confidence >= 0.5 ? '#f59e0b' : // amber-500
           '#ef4444'; // red-500

         const percentage = Math.round(confidence * 100);

         return (
           <div className={cn('relative inline-flex items-center justify-center', className)}>
             <svg width={size} height={size} className="-rotate-90">
               {/* Background ring */}
               <circle
                 cx={size / 2}
                 cy={size / 2}
                 r={radius}
                 stroke="#e2e8f0"
                 strokeWidth={strokeWidth}
                 fill="none"
               />
               {/* Animated progress ring */}
               <motion.circle
                 cx={size / 2}
                 cy={size / 2}
                 r={radius}
                 stroke={color}
                 strokeWidth={strokeWidth}
                 fill="none"
                 strokeLinecap="round"
                 strokeDasharray={circumference}
                 initial={{ strokeDashoffset: circumference }}
                 animate={{ strokeDashoffset: offset }}
                 transition={{
                   duration: 1.2,
                   ease: [0.4, 0, 0.2, 1], // ease-out cubic
                   delay: 0.2,
                 }}
               />
             </svg>
             {/* Center text */}
             <motion.span
               className="absolute text-xs font-bold"
               style={{ color }}
               initial={{ opacity: 0, scale: 0.5 }}
               animate={{ opacity: 1, scale: 1 }}
               transition={{ delay: 0.6, duration: 0.4 }}
             >
               {percentage}%
             </motion.span>
           </div>
         );
       }
       ```

    3. Create `src/components/pipeline/processing-timer.tsx` — live elapsed time counter:

       ```typescript
       'use client';

       import { useState, useEffect, useRef } from 'react';
       import { motion } from 'framer-motion';
       import { cn } from '@/lib/utils';
       import { Clock } from 'lucide-react';

       interface ProcessingTimerProps {
         isRunning: boolean;
         className?: string;
       }

       export function ProcessingTimer({ isRunning, className }: ProcessingTimerProps) {
         const [elapsed, setElapsed] = useState(0);
         const startTimeRef = useRef<number | null>(null);
         const rafRef = useRef<number | null>(null);

         useEffect(() => {
           if (isRunning) {
             startTimeRef.current = Date.now();
             setElapsed(0);

             const tick = () => {
               if (startTimeRef.current) {
                 setElapsed(Date.now() - startTimeRef.current);
               }
               rafRef.current = requestAnimationFrame(tick);
             };
             rafRef.current = requestAnimationFrame(tick);

             return () => {
               if (rafRef.current) {
                 cancelAnimationFrame(rafRef.current);
               }
             };
           } else {
             // Stop timer but keep the final elapsed value
             if (rafRef.current) {
               cancelAnimationFrame(rafRef.current);
               rafRef.current = null;
             }
           }
         }, [isRunning]);

         // Format elapsed time
         const seconds = (elapsed / 1000).toFixed(1);

         return (
           <motion.div
             className={cn(
               'flex items-center gap-1.5 text-xs font-mono',
               isRunning ? 'text-blue-600' : 'text-slate-500',
               className,
             )}
             initial={{ opacity: 0, y: 4 }}
             animate={{ opacity: 1, y: 0 }}
             transition={{ duration: 0.3 }}
           >
             <Clock className={cn(
               'h-3 w-3',
               isRunning && 'animate-spin [animation-duration:3s]',
             )} />
             <span>{seconds}s</span>
           </motion.div>
         );
       }
       ```

       IMPORTANT: The ProcessingTimer uses `requestAnimationFrame` for smooth updates instead of `setInterval(100ms)`. This avoids timer drift and provides smoother visual updates. The component resets when `isRunning` changes from false to true.
  </action>
  <verify>
    - `npm ls framer-motion` shows framer-motion is installed
    - `npx tsc --noEmit` passes for both new components
    - ConfidenceRing renders an SVG circle that animates from 0 to the target confidence
    - ConfidenceRing color changes based on confidence level (green/blue/amber/red)
    - ProcessingTimer counts up smoothly while isRunning=true and freezes when isRunning=false
    - Both components have `'use client'` directive
  </verify>
  <done>
    Framer Motion installed. ConfidenceRing provides animated circular progress with color-coded confidence. ProcessingTimer provides smooth elapsed-time counting with requestAnimationFrame. Both are composable micro-components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance pipeline components with Framer Motion animations</name>
  <files>
    src/components/pipeline/agent-status-card.tsx,
    src/components/pipeline/agent-pipeline-view.tsx,
    src/components/pipeline/pipeline-stage-indicator.tsx,
    src/app/globals.css
  </files>
  <action>
    READ each file first, then update with Framer Motion animations. Preserve all existing logic and structure — only ADD animation wrappers and motion components.

    1. Update `src/components/pipeline/agent-status-card.tsx`:

       Add imports at top:
       ```typescript
       import { motion, AnimatePresence } from 'framer-motion';
       import { ConfidenceRing } from './confidence-ring';
       import { ProcessingTimer } from './processing-timer';
       ```

       **Wrap the entire Card in a motion.div** for entrance animation:
       ```typescript
       <motion.div
         layout
         initial={{ opacity: 0, scale: 0.95, y: 8 }}
         animate={{ opacity: 1, scale: 1, y: 0 }}
         transition={{
           duration: 0.4,
           ease: [0.4, 0, 0.2, 1],
         }}
       >
         <Card ... >
       ```

       **Replace the completed state content** in CardContent with:
       ```typescript
       {status === 'completed' && (
         <motion.div
           className="flex items-center gap-4 text-xs text-muted-foreground"
           initial={{ opacity: 0, y: 4 }}
           animate={{ opacity: 1, y: 0 }}
           transition={{ delay: 0.2, duration: 0.4 }}
         >
           {confidence !== null && (
             <div className="flex items-center gap-2">
               <ConfidenceRing confidence={confidence} size={36} strokeWidth={2.5} />
               <span>confidence</span>
             </div>
           )}
           {durationMs !== null && (
             <div className="flex items-center gap-1">
               <span className="font-medium text-slate-600">
                 {durationMs < 1000
                   ? `${durationMs}ms`
                   : `${(durationMs / 1000).toFixed(1)}s`}
               </span>
               <span>elapsed</span>
             </div>
           )}
         </motion.div>
       )}
       ```

       **Replace the running state content** with:
       ```typescript
       {status === 'running' && (
         <motion.div
           className="flex items-center justify-between"
           initial={{ opacity: 0 }}
           animate={{ opacity: 1 }}
           transition={{ duration: 0.3 }}
         >
           <div className="flex items-center gap-2 text-xs text-blue-600">
             <div className="flex gap-1">
               <span className="inline-block h-1.5 w-1.5 rounded-full bg-blue-500 animate-bounce [animation-delay:0ms]" />
               <span className="inline-block h-1.5 w-1.5 rounded-full bg-blue-500 animate-bounce [animation-delay:150ms]" />
               <span className="inline-block h-1.5 w-1.5 rounded-full bg-blue-500 animate-bounce [animation-delay:300ms]" />
             </div>
             <span>Processing...</span>
           </div>
           <ProcessingTimer isRunning={true} />
         </motion.div>
       )}
       ```

       **Replace the failed state content** with:
       ```typescript
       {status === 'failed' && error && (
         <motion.p
           className="text-xs text-red-600 truncate"
           title={error}
           initial={{ opacity: 0, x: -8 }}
           animate={{ opacity: 1, x: 0 }}
           transition={{ duration: 0.3, type: 'spring' }}
         >
           {error}
         </motion.p>
       )}
       ```

       **Update the pending state opacity** — remove the `opacity-60` from the Card className and instead use Framer Motion's opacity:
       - In the Card's className, change `status === 'pending' && 'opacity-60'` to just the border styling
       - Let the motion.div wrapper handle opacity via the initial/animate values conditionally

    2. Update `src/components/pipeline/agent-pipeline-view.tsx`:

       Add imports:
       ```typescript
       import { motion, AnimatePresence, LayoutGroup } from 'framer-motion';
       ```

       **Wrap the agent cards section** in a LayoutGroup for coordinated layout animations:
       ```typescript
       <LayoutGroup>
         <div className="space-y-4">
           {/* ... all the stage rows */}
         </div>
       </LayoutGroup>
       ```

       **Add staggered entrance animations** for the stage rows. Wrap each stage row in a motion.div:

       Stage 1 (Document Processing):
       ```typescript
       <motion.div
         className="flex justify-center"
         initial={{ opacity: 0, y: 20 }}
         animate={{ opacity: 1, y: 0 }}
         transition={{ delay: 0, duration: 0.5 }}
       >
       ```

       Stage 2 (Parallel Verification):
       ```typescript
       <motion.div
         className="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto"
         initial={{ opacity: 0, y: 20 }}
         animate={{ opacity: 1, y: 0 }}
         transition={{ delay: 0.1, duration: 0.5 }}
       >
       ```

       Stage 3 (Risk Scoring):
       ```typescript
       <motion.div
         className="flex justify-center"
         initial={{ opacity: 0, y: 20 }}
         animate={{ opacity: 1, y: 0 }}
         transition={{ delay: 0.2, duration: 0.5 }}
       >
       ```

       Stage 4 (Case Narrative):
       ```typescript
       <motion.div
         className="flex justify-center"
         initial={{ opacity: 0, y: 20 }}
         animate={{ opacity: 1, y: 0 }}
         transition={{ delay: 0.3, duration: 0.5 }}
       >
       ```

       **Animate connector lines** — wrap connector divs in motion.div with scale animation:
       ```typescript
       <motion.div
         className="flex justify-center"
         initial={{ scaleY: 0 }}
         animate={{ scaleY: 1 }}
         transition={{ delay: 0.15, duration: 0.3, ease: 'easeOut' }}
         style={{ transformOrigin: 'top' }}
       >
         {/* existing connector content */}
       </motion.div>
       ```

    3. Update `src/components/pipeline/pipeline-stage-indicator.tsx`:

       Add imports:
       ```typescript
       import { motion } from 'framer-motion';
       ```

       **Wrap stage nodes** in motion.div for entrance animation with stagger:
       ```typescript
       <motion.div
         key={stage.id}
         className="flex items-center"
         initial={{ opacity: 0, scale: 0.8 }}
         animate={{ opacity: 1, scale: 1 }}
         transition={{ delay: index * 0.1, duration: 0.3 }}
       >
       ```

       **Animate the stage circle** when it becomes active — add a spring animation:
       ```typescript
       <motion.div
         className={cn(
           'flex h-9 w-9 items-center justify-center rounded-full border-2 transition-colors duration-500',
           // ... existing color classes
         )}
         animate={{
           scale: isActive ? [1, 1.15, 1] : 1,
         }}
         transition={{
           scale: {
             duration: 0.5,
             ease: 'easeInOut',
             repeat: isActive ? Infinity : 0,
             repeatDelay: 1,
           },
         }}
       >
       ```

       **Animate the connector lines** growing from left to right when completed:
       ```typescript
       <motion.div
         className={cn(
           'h-0.5 w-8 mx-1 mt-[-16px]',
           isCompleted ? 'bg-emerald-400' : 'bg-slate-200',
         )}
         initial={{ scaleX: 0 }}
         animate={{ scaleX: 1 }}
         transition={{ delay: index * 0.1 + 0.05, duration: 0.3 }}
         style={{ transformOrigin: 'left' }}
       />
       ```

    4. Update `src/app/globals.css` — ensure the shimmer keyframe is defined. READ the file first, then add if not present:

       ```css
       @keyframes shimmer {
         0% { transform: translateX(-100%); }
         100% { transform: translateX(400%); }
       }
       ```

       Also add a subtle glow animation for running cards:
       ```css
       @keyframes glow-pulse {
         0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
         50% { box-shadow: 0 0 20px 4px rgba(59, 130, 246, 0.15); }
       }
       ```

       Add Tailwind utility classes for these animations by adding to the CSS:
       ```css
       .animate-glow-pulse {
         animation: glow-pulse 2s ease-in-out infinite;
       }
       ```

       Then use `animate-glow-pulse` on the running AgentStatusCard in addition to the ring styling.

    IMPORTANT ANIMATION PRINCIPLES:
    - Use spring physics for interactive elements (status changes, active indicators)
    - Use ease-out cubic `[0.4, 0, 0.2, 1]` for entrance animations
    - Keep animation durations under 500ms for transitions (don't feel sluggish)
    - Stagger child animations by 100ms increments
    - The ProcessingTimer replaces the static "Processing..." text with live elapsed time
    - The ConfidenceRing replaces the plain percentage text with an animated circular indicator
    - DO NOT add exit animations to cards — cards don't unmount, they transition states
  </action>
  <verify>
    - `npx tsc --noEmit` passes for all modified files
    - Agent cards animate in with scale + fade on initial render
    - Running cards show glow pulse, live timer, and bouncing dots
    - Completed cards show animated confidence ring filling to the correct percentage
    - Failed cards show error with spring slide-in
    - Pipeline stage indicator nodes pulse when active
    - Connector lines animate growth direction (top-to-bottom, left-to-right)
    - Stage rows stagger their entrance by 100ms increments
    - All animations run at 60fps (no jank)
    - `src/app/globals.css` contains shimmer and glow-pulse keyframes
  </verify>
  <done>
    All pipeline visualization components enhanced with Framer Motion. Cards have entrance animations, status transitions, and micro-interactions. ConfidenceRing provides animated circular progress. ProcessingTimer shows live elapsed time. Stage indicator pulses on active stage. Connector lines animate growth. Staggered entrance creates a cascading reveal effect.
  </done>
</task>

</tasks>

<verification>
1. `npm ls framer-motion` shows framer-motion installed
2. `npx tsc --noEmit` passes for all modified/created files
3. ConfidenceRing SVG animates from 0% to target confidence with color coding
4. ProcessingTimer counts up smoothly in real-time using requestAnimationFrame
5. Agent cards have entrance animations (scale + fade + translate)
6. Running cards show glow pulse, live timer, bouncing dots, and shimmer progress bar
7. Completed cards show animated confidence ring and formatted duration
8. Failed cards show error with spring slide-in animation
9. Pipeline stage indicator active node pulses subtly
10. Connector lines animate growth as pipeline progresses
11. Stage rows stagger entrance by 100ms increments
12. globals.css has shimmer and glow-pulse keyframe definitions
</verification>

<success_criteria>
- Smooth animations and transitions throughout the pipeline visualization (DASH-06)
- Running agents visually distinct with multiple animation layers (shimmer, glow, timer, dots)
- Confidence visualization is rich and informative (animated ring with color coding)
- Animations enhance comprehension (you can FEEL the pipeline progressing)
- No animation jank — all transitions are 60fps smooth
</success_criteria>

<output>
After completion, create `.planning/phases/07-agent-visualization/07-03-SUMMARY.md`
</output>
