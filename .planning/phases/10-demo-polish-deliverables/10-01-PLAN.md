---
phase: 10-demo-polish-deliverables
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/seed-demo-data.ts
  - src/lib/demo/cases.ts
  - src/lib/demo/agent-results.ts
  - src/lib/demo/documents.ts
  - src/lib/demo/audit-trail.ts
autonomous: true

must_haves:
  truths:
    - "Running the seed script populates the database with 5 realistic demo cases"
    - "Demo cases cover the full risk spectrum: clean (low), suspicious (critical), edge case (medium), PEP (high), multi-document (low-medium)"
    - "Each case has pre-computed agent results so the demo does not depend on live API calls"
    - "At least 2 cases have decisions already recorded to show the audit trail"
    - "All demo data uses realistic but clearly fictional names and details"
  artifacts:
    - path: "src/lib/demo/cases.ts"
      provides: "5 complete demo case definitions with applicant details"
      contains: "demoCases"
    - path: "src/lib/demo/agent-results.ts"
      provides: "Pre-computed agent results for all 5 cases (document processor, identity verifier, sanctions screener, risk scorer, case narrator)"
      contains: "demoAgentResults"
    - path: "src/lib/demo/documents.ts"
      provides: "Simulated document records and OCR outputs for each case"
      contains: "demoDocuments"
    - path: "src/lib/demo/audit-trail.ts"
      provides: "Audit log entries for decided cases"
      contains: "demoAuditLogs"
    - path: "scripts/seed-demo-data.ts"
      provides: "CLI script that seeds all demo data into Supabase"
      contains: "seedDemoData"
  key_links:
    - from: "scripts/seed-demo-data.ts"
      to: "src/lib/supabase/server.ts"
      via: "uses server Supabase client to insert data"
      pattern: "import.*createServerSupabaseClient.*from"
    - from: "scripts/seed-demo-data.ts"
      to: "src/lib/demo/cases.ts"
      via: "imports demo case definitions"
      pattern: "import.*demoCases.*from"
    - from: "src/lib/demo/agent-results.ts"
      to: "src/types/agents.ts"
      via: "uses AgentResult, RiskScorerOutput, etc. for type-safe demo data"
      pattern: "import.*AgentResult.*from.*@/types"
---

<objective>
Create the complete demo data seed system with 5 realistic KYC/AML cases that showcase the full range of the platform's capabilities: a clean approval, a sanctions match requiring escalation, a partial document failure, a PEP case, and a multi-document case.

Purpose: The demo data is what Wealthsimple reviewers will see. It must tell a compelling story about the system's capabilities — showing that the AI orchestrator handles routine cases, catches genuine risks, and knows when to defer to human judgment. Pre-computed agent results ensure the demo runs instantly without depending on live API calls.

Output: Type-safe demo data definitions for 5 cases with all associated agent results, documents, and audit trails, plus a CLI seed script that populates Supabase in one command.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/types/agents.ts
@src/types/pipeline.ts
@src/lib/supabase/server.ts
@src/lib/supabase/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define 5 realistic demo cases with applicant details and documents</name>
  <files>src/lib/demo/cases.ts, src/lib/demo/documents.ts</files>
  <action>
    Create `src/lib/demo/cases.ts` with 5 complete demo case definitions. Each case must tell a distinct story about the system's capabilities.

    Import types from `@/types` (Case, CaseStatus, RiskLevel, DecisionType).

    Use deterministic UUIDs (hardcoded) so the seed script is idempotent. Format: `10000000-0000-0000-0000-00000000000X` for cases, `20000000-...` for documents, etc.

    **Case 1: Clean Applicant (Low Risk - Approved)**
    ```typescript
    {
      id: '10000000-0000-0000-0000-000000000001',
      status: 'approved' as CaseStatus,
      applicant_name: 'Sarah Chen',
      applicant_email: 'sarah.chen@example.com',
      risk_score: 12,
      risk_level: 'low' as RiskLevel,
      decision: 'approved' as DecisionType,
      decision_justification: 'All documents verified. No sanctions matches. Identity confirmed with high confidence. Standard low-risk profile consistent with stated purpose of account.',
      officer_id: 'officer-demo-001',
      narrative: null, // Will be set in agent-results.ts
      created_at: new Date(Date.now() - 86400000 * 3).toISOString(), // 3 days ago
      updated_at: new Date(Date.now() - 86400000 * 2).toISOString(), // 2 days ago
    }
    ```
    Background: 34-year-old Canadian software engineer opening a personal investment account. Clean passport, no sanctions matches, all documents clear. Straightforward approval.

    **Case 2: Suspicious Applicant (Critical Risk - Escalated)**
    ```typescript
    {
      id: '10000000-0000-0000-0000-000000000002',
      status: 'escalated' as CaseStatus,
      applicant_name: 'Viktor Petrov',
      applicant_email: 'v.petrov@example.com',
      risk_score: 87,
      risk_level: 'critical' as RiskLevel,
      decision: 'escalated' as DecisionType,
      decision_justification: 'High-confidence sanctions match against OFAC SDN list (Viktor PETROV, SDGT program). Name similarity score 0.94. Escalated to senior compliance for enhanced due diligence review. STR filing may be required.',
      officer_id: 'officer-demo-001',
      narrative: null,
      created_at: new Date(Date.now() - 86400000 * 2).toISOString(), // 2 days ago
      updated_at: new Date(Date.now() - 86400000 * 1).toISOString(), // 1 day ago
    }
    ```
    Background: 52-year-old with Russian passport. Fuzzy match against OFAC SDN list with high similarity score. System auto-flagged and recommended escalation. This is the "the system catches real threats" story.

    **Case 3: Edge Case (Medium Risk - In Review)**
    ```typescript
    {
      id: '10000000-0000-0000-0000-000000000003',
      status: 'review' as CaseStatus,
      applicant_name: 'Amara Okafor',
      applicant_email: 'amara.okafor@example.com',
      risk_score: 45,
      risk_level: 'medium' as RiskLevel,
      decision: null,
      decision_justification: null,
      officer_id: null,
      narrative: null,
      created_at: new Date(Date.now() - 86400000 * 1).toISOString(), // 1 day ago
      updated_at: new Date(Date.now() - 3600000 * 6).toISOString(), // 6 hours ago
    }
    ```
    Background: 28-year-old Nigerian-Canadian with a driver's license that has poor image quality (low OCR confidence). No sanctions matches, but identity verification has a discrepancy — name on utility bill is slightly different ("A. Okafor" vs "Amara Okafor"). System flagged for manual review due to low document confidence. This shows "where AI stops."

    **Case 4: PEP Case (High Risk - In Review)**
    ```typescript
    {
      id: '10000000-0000-0000-0000-000000000004',
      status: 'review' as CaseStatus,
      applicant_name: 'Maria Gonzalez-Rivera',
      applicant_email: 'mgonzalez@example.com',
      risk_score: 68,
      risk_level: 'high' as RiskLevel,
      decision: null,
      decision_justification: null,
      officer_id: null,
      narrative: null,
      created_at: new Date(Date.now() - 3600000 * 12).toISOString(), // 12 hours ago
      updated_at: new Date(Date.now() - 3600000 * 2).toISOString(), // 2 hours ago
    }
    ```
    Background: 45-year-old Mexican diplomat (identified as PEP). Clean documents, no sanctions matches, but PEP status triggers elevated scrutiny. System correctly identifies that PEP cases require enhanced due diligence regardless of other signals. This shows regulatory awareness.

    **Case 5: Multi-Document Case (Processing)**
    ```typescript
    {
      id: '10000000-0000-0000-0000-000000000005',
      status: 'processing' as CaseStatus,
      applicant_name: 'James Oduya',
      applicant_email: 'j.oduya@example.com',
      risk_score: null,
      risk_level: null,
      decision: null,
      decision_justification: null,
      officer_id: null,
      narrative: null,
      created_at: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
      updated_at: new Date(Date.now() - 60000 * 5).toISOString(), // 5 min ago
    }
    ```
    Background: 39-year-old Canadian submitting passport + utility bill + bank statement. Currently being processed by agents. This case shows the live agent visualization state — agents are mid-flight.

    Export all cases as `export const demoCases: Omit<Case, 'narrative'>[]` (narrative comes from agent results).

    ---

    Create `src/lib/demo/documents.ts` with document records for each case:

    Import types from `@/types` (Document, DocumentType).

    **Case 1 (Sarah Chen) documents:**
    - Passport: Canadian passport, high-quality OCR, confidence 0.95
      - OCR output: Simulated passport OCR text with name "CHEN, SARAH ELIZABETH", DOB "1992-03-15", passport number "GA 123456", expiry "2032-06-20", nationality "CANADIAN"
    - Utility bill: Hydro One bill, confidence 0.92
      - OCR: Address "42 Maple Drive, Toronto, ON M5V 2T6", account holder "Sarah Chen", bill date "2026-01-15"

    **Case 2 (Viktor Petrov) documents:**
    - Passport: Russian Federation passport, confidence 0.89
      - OCR: "PETROV, VIKTOR IVANOVICH", DOB "1974-08-22", passport "75 1234567", nationality "RUSSIAN"

    **Case 3 (Amara Okafor) documents:**
    - Driver's license: Ontario license, LOW confidence 0.62 (poor image quality)
      - OCR: Partial text, some fields garbled. Name extracted as "OKAFOR, AMARA N.", DOB "1998-05-11"
    - Utility bill: Toronto Hydro bill, confidence 0.88
      - OCR: Account holder "A. Okafor", address "188 College St, Apt 4B, Toronto, ON M5T 1P8"

    **Case 4 (Maria Gonzalez-Rivera) documents:**
    - Passport: Mexican passport, confidence 0.93
      - OCR: "GONZALEZ RIVERA, MARIA ELENA", DOB "1981-11-03", nationality "MEXICAN"

    **Case 5 (James Oduya) documents:**
    - Passport: Canadian passport, confidence 0.94
      - OCR: "ODUYA, JAMES KWAME", DOB "1987-07-19", nationality "CANADIAN"
    - Utility bill: Enbridge Gas bill, confidence 0.91
      - OCR: "James Oduya", address "73 Dundas St W, Unit 12, Toronto, ON M5G 1C6"
    - Bank statement: TD Bank statement, confidence 0.90
      - OCR: Account holder "James K. Oduya", account ending in "4872", statement period "Jan 2026"

    Each document record includes: id, case_id, type, file_name, file_url (use `/demo/docs/` placeholder paths), ocr_output (realistic simulated OCR text as markdown), extracted_data (JSON with structured extracted fields), confidence score.

    Make the OCR output look realistic — include typical OCR artifacts like "MACHINE READABLE ZONE", tabular data, headers, and formatting that real Mistral OCR would produce from these document types.

    Export as `export const demoDocuments: Omit<Document, 'id'>[] & { id: string }[]`.
  </action>
  <verify>
    - `npx tsc --noEmit` passes for both files
    - `src/lib/demo/cases.ts` exports 5 cases with deterministic UUIDs
    - `src/lib/demo/documents.ts` exports documents for all 5 cases (8-9 total documents)
    - Risk scores match risk levels: Case 1 (12, low), Case 2 (87, critical), Case 3 (45, medium), Case 4 (68, high), Case 5 (null, processing)
    - Decided cases (1, 2) have decision_justification and officer_id
    - Undecided cases (3, 4, 5) have null decision fields
    - All UUIDs are deterministic and non-colliding across cases/documents
    - OCR outputs are multi-line realistic strings, not single-line placeholders
  </verify>
  <done>
    5 demo cases defined with realistic applicant profiles spanning the full risk spectrum. 8-9 document records with simulated OCR outputs that look like real Mistral OCR results. Each case tells a distinct story about the system's capabilities.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create pre-computed agent results, audit trail, and seed script</name>
  <files>src/lib/demo/agent-results.ts, src/lib/demo/audit-trail.ts, scripts/seed-demo-data.ts</files>
  <action>
    Create `src/lib/demo/agent-results.ts` with pre-computed agent run records for all 5 cases. Import types from `@/types` (AgentRun, AgentRunStatus, AgentType).

    Each case needs agent_runs records for: document_processor, identity_verifier, sanctions_screener, risk_scorer, case_narrator (plus orchestrator).

    **Case 1 (Sarah Chen - Clean):** All agents completed successfully.
    - orchestrator: status 'completed', started 3 days ago, completed 3 days ago minus 2.5 min
    - document_processor: status 'completed', confidence 0.95, output contains extracted fields with high confidence. Duration: ~45s
    - identity_verifier: status 'completed', confidence 0.97, output: verified=true, 0 discrepancies. Duration: ~30s
    - sanctions_screener: status 'completed', confidence 0.99, output: flagged=false, 0 matches, lists_checked=['OFAC_SDN','UN_SECURITY_COUNCIL','PEP']. Duration: ~20s
    - risk_scorer: status 'completed', confidence 0.95, output: risk_score=12, risk_level='low', requires_manual_review=false, risk_factors showing all green. Duration: ~15s
    - case_narrator: status 'completed', confidence 0.93, output: narrative is a 3-4 paragraph compliance assessment recommending approval. Key findings: clean document verification, no sanctions matches, verified identity. Duration: ~25s

    **Case 2 (Viktor Petrov - Sanctions Match):** Sanctions screener flagged, risk scorer critical.
    - document_processor: completed, confidence 0.89
    - identity_verifier: completed, confidence 0.85
    - sanctions_screener: completed, confidence 0.94, output: flagged=true, matches=[{list_name:'OFAC_SDN', matched_name:'PETROV, Viktor', match_score:0.94, entry_id:'ofac-12345', details:'SDGT program, linked to sanctioned entity'}]
    - risk_scorer: completed, output: risk_score=87, risk_level='critical', requires_manual_review=true, risk_factors showing sanctions as primary driver (weight 0.35, score 95)
    - case_narrator: completed, narrative warns about sanctions match, recommends escalation and possible STR filing

    **Case 3 (Amara Okafor - Edge Case):** Document processor has low confidence, identity has discrepancy.
    - document_processor: completed, confidence 0.62 (low quality driver's license)
    - identity_verifier: completed, confidence 0.71, output: verified=false, discrepancies=['Name mismatch: "OKAFOR, AMARA N." vs "A. Okafor" — abbreviated first name on utility bill']
    - sanctions_screener: completed, confidence 0.98, flagged=false
    - risk_scorer: completed, risk_score=45, risk_level='medium', requires_manual_review=true (due to low doc confidence + identity discrepancy)
    - case_narrator: completed, narrative explains the medium risk driven by document quality issues, suggests requesting a clearer copy of the driver's license

    **Case 4 (Maria Gonzalez-Rivera - PEP):** PEP match, elevated scrutiny.
    - document_processor: completed, confidence 0.93
    - identity_verifier: completed, confidence 0.96, verified=true
    - sanctions_screener: completed, confidence 0.91, output: flagged=true (PEP match, not sanctions match), matches=[{list_name:'PEP', matched_name:'GONZALEZ RIVERA, Maria Elena', match_score:0.88, details:'Senior diplomat, Mexican Ministry of Foreign Affairs'}]
    - risk_scorer: completed, risk_score=68, risk_level='high', requires_manual_review=true
    - case_narrator: completed, narrative explains PEP status triggers enhanced due diligence, documents are clean but elevated scrutiny required per FINTRAC guidelines

    **Case 5 (James Oduya - Processing):** Agents mid-flight.
    - orchestrator: status 'running', started 5 min ago
    - document_processor: status 'completed', confidence 0.94 (passport processed first)
    - identity_verifier: status 'running', started 2 min ago (in parallel with sanctions)
    - sanctions_screener: status 'running', started 2 min ago (in parallel with identity)
    - risk_scorer: status 'pending' (waiting for verification agents)
    - case_narrator: status 'pending'

    For completed agent runs, include realistic input/output JSONB that matches the type contracts from `src/types/agents.ts`. Store the case narrator output.narrative text in the case record as well.

    Use deterministic UUIDs: `30000000-0000-0000-0000-0000000000XX` for agent runs.

    Export as `export const demoAgentRuns: (Omit<AgentRun, 'id'> & { id: string })[]`.
    Also export `export const demoCaseNarratives: Record<string, string>` mapping case_id to the narrative text (to update the cases table).

    ---

    Create `src/lib/demo/audit-trail.ts` with audit log entries for decided cases (1 and 2).

    Each decided case should have audit entries showing the full lifecycle:
    - 'case_created' (actor_type: 'system')
    - 'processing_started' (actor_type: 'system')
    - 'agent_completed' for each agent (actor_type: 'agent', actor_id: agent_type)
    - 'processing_completed' (actor_type: 'system')
    - 'case_reviewed' (actor_type: 'officer', actor_id: 'officer-demo-001')
    - 'decision_made' (actor_type: 'officer', details include decision and justification)

    For Case 2 (escalated), also include:
    - 'escalation_triggered' (actor_type: 'system', details: 'Critical risk score triggered auto-escalation recommendation')
    - 'str_review_flagged' (actor_type: 'system', details: 'Potential STR filing required — deferred to senior compliance officer')

    For Cases 3, 4 (in review), include entries up to 'processing_completed'.
    For Case 5 (processing), include 'case_created' and 'processing_started' only.

    Use deterministic UUIDs: `40000000-0000-0000-0000-0000000000XX` for audit logs.
    Export as `export const demoAuditLogs: (Omit<AuditLog, 'id'> & { id: string })[]`.

    ---

    Create `scripts/seed-demo-data.ts` — a CLI script that seeds all demo data into Supabase.

    ```typescript
    // Runnable with: npx tsx scripts/seed-demo-data.ts
    // Requires .env.local with Supabase credentials

    import { createServerSupabaseClient } from '../src/lib/supabase/server';
    import { demoCases } from '../src/lib/demo/cases';
    import { demoDocuments } from '../src/lib/demo/documents';
    import { demoAgentRuns, demoCaseNarratives } from '../src/lib/demo/agent-results';
    import { demoAuditLogs } from '../src/lib/demo/audit-trail';
    ```

    The script must:
    1. Initialize Supabase server client
    2. Delete existing demo data first (WHERE id LIKE '10000000%' OR id LIKE '20000000%' etc.) for idempotency
    3. Insert cases (with narratives from demoCaseNarratives)
    4. Insert documents
    5. Insert agent_runs
    6. Insert audit_logs
    7. Print summary: "Seeded X cases, Y documents, Z agent runs, W audit logs"
    8. Handle errors gracefully — if one insert fails, log and continue

    Add a `--clean` flag that only deletes demo data without re-inserting (useful for cleanup).

    IMPORTANT: The script must load .env.local for the Supabase credentials. Use `dotenv` package:
    ```typescript
    import 'dotenv/config'; // or import { config } from 'dotenv'; config({ path: '.env.local' });
    ```
    Install dotenv if not already in package.json.

    Order of inserts matters (foreign key constraints):
    1. cases first
    2. documents (references cases.id)
    3. agent_runs (references cases.id)
    4. audit_logs (references cases.id)
  </action>
  <verify>
    - `npx tsc --noEmit` passes for all three files
    - `src/lib/demo/agent-results.ts` exports agent runs for all 5 cases (25-30 total agent run records)
    - `src/lib/demo/audit-trail.ts` exports audit logs for all 5 cases (~30-40 entries total)
    - `scripts/seed-demo-data.ts` compiles and runs: `npx tsx scripts/seed-demo-data.ts`
    - After running seed script: `SELECT count(*) FROM cases WHERE id LIKE '10000000%'` returns 5
    - After running seed script: `SELECT count(*) FROM documents WHERE case_id LIKE '10000000%'` returns 8-9
    - Re-running the seed script produces the same result (idempotent)
    - The `--clean` flag deletes all demo data without errors
    - Agent results for Case 5 show 'running' and 'pending' statuses (not all 'completed')
    - Case narratives are multi-paragraph text, not single-sentence placeholders
  </verify>
  <done>
    Complete demo data seed system operational. 5 cases with 25-30 agent runs, 8-9 documents, and 30-40 audit log entries. Seed script is idempotent and populates Supabase in one command. Pre-computed agent results mean the demo runs instantly without live API calls.
  </done>
</task>

</tasks>

<verification>
1. `npx tsx scripts/seed-demo-data.ts` runs without errors and prints a summary
2. Supabase has 5 cases spanning all statuses: approved, escalated, review, review, processing
3. Risk scores cover the spectrum: 12 (low), 87 (critical), 45 (medium), 68 (high), null (processing)
4. Cases 1 and 2 have officer decisions with justification text
5. Cases 3 and 4 are awaiting review (decision is null)
6. Case 5 shows agents mid-processing (running/pending statuses)
7. Each case has realistic OCR output text in its documents
8. Audit trail shows complete lifecycle for decided cases
9. All demo data uses deterministic UUIDs and is idempotent on re-run
</verification>

<success_criteria>
- 3-5 realistic demo cases loaded with mix of clean, suspicious, and edge cases (DEPLOY-03)
- Demo data includes pre-computed agent results, risk scores, and narratives
- Seed script is one-command: `npx tsx scripts/seed-demo-data.ts`
- Data tells a compelling story: routine approval, sanctions catch, document quality issue, PEP scrutiny, live processing
</success_criteria>

<output>
After completion, create `.planning/phases/10-demo-polish-deliverables/10-01-SUMMARY.md`
</output>
